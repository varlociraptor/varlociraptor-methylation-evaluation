#!/usr/bin/env python3
import pandas as pd
import re
from pathlib import Path
import altair as alt
import argparse

# -----------------------------------------------------
# Parse command-line arguments
# # -----------------------------------------------------
files = snakemake.input
for file in files:
    print(file=file, file=sys.stderr)
# parser = argparse.ArgumentParser(description="Create runtime comparison plot from benchmark files.")
# parser.add_argument("--input_dir", required=True, help="Root directory containing benchmark results")
# parser.add_argument("--output", required=True, help="Output HTML file for the Altair plot")
# args = parser.parse_args()

# ROOT = Path(args.input_dir)

# records = []

# # -----------------------------------------------------
# # Extract runtimes from .benchmark.txt files
# # -----------------------------------------------------
# for f in ROOT.rglob("*.benchmark.txt"):
#     text = f.read_text(errors="ignore")

#     match = re.search(r"real\s+(\d+)m([\d\.]+)s", text)
#     if not match:
#         continue
#     minutes, seconds = map(float, match.groups())
#     runtime_min = minutes + seconds / 60

#     parts = [p.lower() for p in f.parts]

#     # Detect sequencing platform
#     platform = next((p for p in ["illumina", "pacbio", "nanopore"] if p in parts), None)
#     if not platform:
#         continue

#     # Detect replicate (REP01, REP02, etc.)
#     rep_match = re.search(r"(rep\d+)", "_".join(parts))
#     replicate = rep_match.group(1).upper() if rep_match else "unknown"

#     # Identify tool and step
#     if "results" in parts:
#         tool = "my_tool"
#         if "preprocessing" in parts:
#             step = "preprocessing"
#         elif "calling" in parts:
#             step = "calling"
#         elif "single_sample" in parts:
#             step = "single_sample"
#         else:
#             step = "other"
#     elif "methyl_dackel" in parts:
#         tool, step = "methyl_dackel", "full"
#     elif "pb_cpg_tools" in parts:
#         tool, step = "pb_cpg_tools", "full"
#     elif "modkit" in parts:
#         tool, step = "modkit", "full"
#     else:
#         continue

#     records.append({
#         "platform": platform,
#         "replicate": replicate,
#         "tool": tool,
#         "step": step,
#         "runtime_min": runtime_min,
#         "file": str(f)
#     })

# df = pd.DataFrame(records)
# if df.empty:
#     raise SystemExit("Keine Benchmark-Dateien gefunden oder kein 'real' erkannt.")

# # -----------------------------------------------------
# # Plot with Altair
# # -----------------------------------------------------
# chart = (
#     alt.Chart(df)
#     .mark_bar()
#     .encode(
#         x=alt.X("step:N", title="Step", sort=["preprocessing", "calling", "single_sample", "full"]),
#         y=alt.Y("runtime_min:Q", title="Runtime (min)"),
#         color=alt.Color("tool:N", legend=alt.Legend(title="Tool")),
#         column=alt.Column("platform:N", title="Sequencing Platform"),
#         row=alt.Row("replicate:N", title="Replicate"),
#         tooltip=["platform", "replicate", "tool", "step", "runtime_min"]
#     )
#     .properties(width=160, height=180, title="Runtime Comparison per Platform and Replicate")
# )

# chart.save(args.output)
# print(f"âœ… Plot saved to: {args.output}")
